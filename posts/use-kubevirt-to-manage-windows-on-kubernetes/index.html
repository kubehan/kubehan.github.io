<!doctype html><html lang=zh-cn dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>Kubernetes 使用 Kubevirt 运行管理 Windows 10 操作系统 &#183; 云原生知识栈</title>
<meta name=title content="Kubernetes 使用 Kubevirt 运行管理 Windows 10 操作系统 &#183; 云原生知识栈"><meta name=description content="本文介绍了 Kubevirt 的架构，并使用 Kubevirt 来运行管理 Windows 10 虚拟机。"><meta name=keywords content="Kubevirt,Kubernetes,"><link rel=canonical href=https://kubehan.cn/posts/use-kubevirt-to-manage-windows-on-kubernetes/><link type=text/css rel=stylesheet href=/css/main.bundle.min.e27868ab1485f7ed7b06b122b4980bd38b19526eb8f7de885181204d28f04a0c47e9c334eff19a06c0278eb2ff8415b983a5d0fb80fd6b5680c926457cc61c57.css integrity="sha512-4nhoqxSF9+17BrEitJgL04sZUm64996IUYEgTSjwSgxH6cM07/GaBsAnjrL/hBW5g6XQ+4D9a1aAySZFfMYcVw=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.a2d78d78672e549fbfc972ece871725b5478ba0b65708dda20cb97ab80a865eae6d247e1b05a4aec6ebbf78647ec3233bad8b2609ed98eee53cd58aa17128bc7.js integrity="sha512-oteNeGcuVJ+/yXLs6HFyW1R4ugtlcI3aIMuXq4CoZerm0kfhsFpK7G6794ZH7DIzutiyYJ7Zju5TzViqFxKLxw==" data-copy data-copied></script><script src=/lib/zoom/zoom.min.37d2094687372da3f7343a221a470f6b8806f7891aa46a5a03966af7f0ebd38b9fe536cb154e6ad28f006d184b294525a7c4054b6bbb4be62d8b453b42db99bd.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://kubehan.cn/posts/use-kubevirt-to-manage-windows-on-kubernetes/"><meta property="og:site_name" content="云原生知识栈"><meta property="og:title" content="Kubernetes 使用 Kubevirt 运行管理 Windows 10 操作系统"><meta property="og:description" content="本文介绍了 Kubevirt 的架构，并使用 Kubevirt 来运行管理 Windows 10 虚拟机。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-11-13T16:13:56+08:00"><meta property="article:modified_time" content="2020-11-13T16:13:56+08:00"><meta property="article:tag" content="Kubevirt"><meta property="article:tag" content="Kubernetes"><meta property="og:image" content="https://kubehan.cn/posts/use-kubevirt-to-manage-windows-on-kubernetes/featured.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kubehan.cn/posts/use-kubevirt-to-manage-windows-on-kubernetes/featured.jpg"><meta name=twitter:title content="Kubernetes 使用 Kubevirt 运行管理 Windows 10 操作系统"><meta name=twitter:description content="本文介绍了 Kubevirt 的架构，并使用 Kubevirt 来运行管理 Windows 10 虚拟机。"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Kubernetes 使用 Kubevirt 运行管理 Windows 10 操作系统","headline":"Kubernetes 使用 Kubevirt 运行管理 Windows 10 操作系统","description":"本文介绍了 Kubevirt 的架构，并使用 Kubevirt 来运行管理 Windows 10 虚拟机。","inLanguage":"zh-cn","url":"https:\/\/kubehan.cn\/posts\/use-kubevirt-to-manage-windows-on-kubernetes\/","author":{"@type":"Person","name":"Kubehan"},"copyrightYear":"2020","dateCreated":"2020-11-13T16:13:56\u002b08:00","datePublished":"2020-11-13T16:13:56\u002b08:00","dateModified":"2020-11-13T16:13:56\u002b08:00","keywords":["kubevirt","cdi","kubernetes"],"mainEntityOfPage":"true","wordCount":"1309"}]</script><meta name=author content="Kubehan"><link href=/index.xml rel=me><link href=https://twitter.com/kubehan rel=me><link href=https://github.com/kubehan rel=me><link href=https://github.com/kubehan rel=me><link href=mailto:hello@kubehan.cn rel=me><link href=https://kubehan.cn/ rel=me><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><script data-id=umami-script async src=https://kubehan.cn/ data-website-id=b40dc4fa-2041-472e-a0eb-aed0dec80ca6></script><script type=text/javascript>document.querySelector('script[data-id="umami-script"]').addEventListener("load",function(){const e=document.head.querySelector('meta[property = "og:type"]').getAttribute("content");let t=document.head.querySelector('meta[property = "og:title"]').getAttribute("content"),n=document.head.querySelector('meta[property = "og:url"]').getAttribute("content");umami.track(e+":"+t,{url:n})})</script><script>document.addEventListener("DOMContentLoaded",function(){var e=document.createElement("link");e.href="https://jsd.onmicrosoft.cn/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css",e.rel="stylesheet",document.head.appendChild(e)})</script><div id=fps style=z-index:999;position:fixed;bottom:3px;right:3px;color:#fff;font-size:10px></div><script defer type=text/javascript src=https://cdn.staticfile.org/layer/3.5.1/layer.min.js></script><script defer type=text/javascript src=https://kubehan.cn/js/fps.js></script><script defer>function loadScriptOnScroll(){var e,t,n,s=window.scrollY||window.pageYOffset;s>100&&(n=n||[],e=document.createElement("script"),e.src="https://hm.baidu.com/hm.js?ebf00ccd579b3755eab3556650cd2b9e",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t),window.removeEventListener("scroll",loadScriptOnScroll))}window.addEventListener("scroll",loadScriptOnScroll)</script><script defer>function loadClarityScript(){(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","m535olg9md"),window.removeEventListener("scroll",onScrollLoadClarity)}function onScrollLoadClarity(){window.scrollY>100&&loadClarityScript()}window.addEventListener("scroll",onScrollLoadClarity)</script><div class=top-scroll-bar style=height:5px;background-color:blue;width:0;position:fixed;top:0;z-index:100></div><script type=text/javascript>$(document).ready(function(){$(window).scroll(function(){$(".top-scroll-bar").attr("style","width: "+$(this).scrollTop()/($(document).height()-$(this).height())*100+"%; display: block;")})})</script><script type=text/javascript>var titleTime,OriginTitile=document.title;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="哥哥，过来玩一会呀 Σ(っ °Д °;)っ",clearTimeout(titleTime)):(document.title="你可算回来了 (｡•ˇ‸ˇ•｡)"+OriginTitile,titleTime=setTimeout(function(){document.title=OriginTitile},2e3))})</script><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>跳过正文</a></div><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">云原生知识栈</a></nav><nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12"><a href class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span><p class="text-base font-medium" title>项目</p></a><a href=https://kubehan.cn target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M496 256c0 137-111 248-248 248-25.6.0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8.0 128.7-68.8 128.7-154.3.0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1.0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6.0-54.7 41.4-107.6 112-107.6 60.9.0 103.6 41.5 103.6 100.9.0 67.1-33.9 113.6-78 113.6-24.3.0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6.0-19-10.2-34.9-31.4-34.9-24.9.0-44.9 25.7-44.9 60.2.0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9.0 361.1.0 256 0 119 111 8 248 8s248 111 248 248z"/></svg></span></span><p class="text-base font-medium" title>专题</p></a><a href=https://kubehan.cn/categories target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></span><p class="text-base font-medium" title=分类>分类</p></a><a href=https://cloud.umami.is/share/LqtNCgFal91I2r5Q/kubehan.cn target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1><span class="relative block icon"><svg viewBox="0 0 576 512"><path fill="currentcolor" d="M288 32c-80.8.0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7.0 24.6C17.3 304 48.6 356 95.4 399.4 142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7.0-24.6-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144 64.5-144 144-144 144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64-11.5.0-22.3-3-31.6-8.4-.2 2.8-.4 5.5-.4 8.4.0 53 43 96 96 96s96-43 96-96-43-96-96-96c-2.8.0-5.6.1-8.4.4 5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></span><p class="text-base font-medium" title>实时访客</p></a><div><div class="cursor-pointer flex items-center nested-menu"><span class=mr-1><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M159.3 5.4c7.8-7.3 19.9-7.2 27.7.1 27.6 25.9 53.5 53.8 77.7 84 11-14.4 23.5-30.1 37-42.9 7.9-7.4 20.1-7.4 28 .1 34.6 33 63.9 76.6 84.5 118 20.3 40.8 33.8 82.5 33.8 111.9C448 404.2 348.2 512 224 512 98.4 512 0 404.1.0 276.5c0-38.4 17.8-85.3 45.4-131.7C73.3 97.7 112.7 48.6 159.3 5.4zM225.7 416c25.3.0 47.7-7 68.8-21 42.1-29.4 53.4-88.2 28.1-134.4-2.8-5.6-5.6-11.2-9.8-16.8l-50.6 58.8S180.8 199 175.1 192c-42 51.8-63.1 81.2-63.1 114.8C112 375.4 162.6 416 225.7 416z"/></svg>
</span></span><a class="text-base font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title>百宝箱
</a><span><span class="relative block icon"><svg viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></div><div class="absolute menuhide"><div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl"><div class="flex flex-col space-y-3"><a href=https://stats.uptimerobot.com/icGQsnFRda target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1></span><p class="text-sm font-sm" title>服务监控</p></a><a href=https://us.umami.is/websites/1055879b-effb-4eab-acce-174829f6a5c5 target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1></span><p class="text-sm font-sm" title>共享文本</p></a><a href=https://icloudnative.io/jstc/ target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M0 96C0 60.7 28.7 32 64 32H448c35.3.0 64 28.7 64 64V416c0 35.3-28.7 64-64 64H64c-35.3.0-64-28.7-64-64V96zM323.8 202.5c-4.5-6.6-11.9-10.5-19.8-10.5s-15.4 3.9-19.8 10.5l-87 127.6L170.7 297c-4.6-5.7-11.5-9-18.7-9s-14.2 3.3-18.7 9l-64 80c-5.8 7.2-6.9 17.1-2.9 25.4S78.8 416 88 416h96 32H424c8.9.0 17.1-4.9 21.2-12.8s3.6-17.4-1.4-24.7l-120-176zM112 192c26.5.0 48-21.5 48-48s-21.5-48-48-48-48 21.5-48 48 21.5 48 48 48z"/></svg></span></span><p class="text-sm font-sm" title>趣味截图</p></a></div></div></div></div><a href=/index.xml class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M0 64C0 46.3 14.3 32 32 32c229.8.0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7.0 64zM128 416c0 35.3-28.7 64-64 64S0 451.3.0 416s28.7-64 64-64 64 28.7 64 64zM32 160c159.1.0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7.0-32-14.3-32-32s14.3-32 32-32z"/></svg></span></span><p class="text-base font-medium" title=rss></p></a><a href=https://twitter.com/kubehan target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></span><p class="text-base font-medium" title=twitter></p></a><a href=https://github.com/kubehan target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span><p class="text-base font-medium" title=github></p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="ltr:mr-14 rtl:ml-14 flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center space-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400" style=margin-right:5px><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div class=mr-2><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></div><p class="text-bg font-bg" title>项目</p></a></li><li class=mt-1><a href=https://kubehan.cn target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div class=mr-2><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M496 256c0 137-111 248-248 248-25.6.0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8.0 128.7-68.8 128.7-154.3.0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1.0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6.0-54.7 41.4-107.6 112-107.6 60.9.0 103.6 41.5 103.6 100.9.0 67.1-33.9 113.6-78 113.6-24.3.0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6.0-19-10.2-34.9-31.4-34.9-24.9.0-44.9 25.7-44.9 60.2.0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9.0 361.1.0 256 0 119 111 8 248 8s248 111 248 248z"/></svg></span></div><p class="text-bg font-bg" title>专题</p></a></li><li class=mt-1><a href=https://kubehan.cn/categories target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div class=mr-2><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><p class="text-bg font-bg" title=分类>分类</p></a></li><li class=mt-1><a href=https://cloud.umami.is/share/LqtNCgFal91I2r5Q/kubehan.cn target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div class=mr-2><span class="relative block icon"><svg viewBox="0 0 576 512"><path fill="currentcolor" d="M288 32c-80.8.0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7.0 24.6C17.3 304 48.6 356 95.4 399.4 142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7.0-24.6-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144 64.5-144 144-144 144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64-11.5.0-22.3-3-31.6-8.4-.2 2.8-.4 5.5-.4 8.4.0 53 43 96 96 96s96-43 96-96-43-96-96-96c-2.8.0-5.6.1-8.4.4 5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></div><p class="text-bg font-bg" title>实时访客</p></a></li><li class=mt-1><a href class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M159.3 5.4c7.8-7.3 19.9-7.2 27.7.1 27.6 25.9 53.5 53.8 77.7 84 11-14.4 23.5-30.1 37-42.9 7.9-7.4 20.1-7.4 28 .1 34.6 33 63.9 76.6 84.5 118 20.3 40.8 33.8 82.5 33.8 111.9C448 404.2 348.2 512 224 512 98.4 512 0 404.1.0 276.5c0-38.4 17.8-85.3 45.4-131.7C73.3 97.7 112.7 48.6 159.3 5.4zM225.7 416c25.3.0 47.7-7 68.8-21 42.1-29.4 53.4-88.2 28.1-134.4-2.8-5.6-5.6-11.2-9.8-16.8l-50.6 58.8S180.8 199 175.1 192c-42 51.8-63.1 81.2-63.1 114.8C112 375.4 162.6 416 225.7 416z"/></svg></span></span><p class="text-bg font-bg" title>百宝箱</p><span><span class="relative block icon"><svg viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></a></li><li class=mt-1><a href=https://stats.uptimerobot.com/icGQsnFRda target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1></span><p class="text-sm font-small" title>服务监控</p></a></li><li class=mt-1><a href=https://us.umami.is/websites/1055879b-effb-4eab-acce-174829f6a5c5 target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1></span><p class="text-sm font-small" title>共享文本</p></a></li><li class=mt-1><a href=https://icloudnative.io/jstc/ target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M0 96C0 60.7 28.7 32 64 32H448c35.3.0 64 28.7 64 64V416c0 35.3-28.7 64-64 64H64c-35.3.0-64-28.7-64-64V96zM323.8 202.5c-4.5-6.6-11.9-10.5-19.8-10.5s-15.4 3.9-19.8 10.5l-87 127.6L170.7 297c-4.6-5.7-11.5-9-18.7-9s-14.2 3.3-18.7 9l-64 80c-5.8 7.2-6.9 17.1-2.9 25.4S78.8 416 88 416h96 32H424c8.9.0 17.1-4.9 21.2-12.8s3.6-17.4-1.4-24.7l-120-176zM112 192c26.5.0 48-21.5 48-48s-21.5-48-48-48-48 21.5-48 48 21.5 48 48 48z"/></svg></span></span><p class="text-sm font-small" title>趣味截图</p></a></li><li class=mb-2></li><li class=mt-1><a href=/index.xml class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M0 64C0 46.3 14.3 32 32 32c229.8.0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7.0 64zM128 416c0 35.3-28.7 64-64 64S0 451.3.0 416s28.7-64 64-64 64 28.7 64 64zM32 160c159.1.0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7.0-32-14.3-32-32s14.3-32 32-32z"/></svg></span></div><p class="text-bg font-bg" title=rss></p></a></li><li class=mt-1><a href=https://twitter.com/kubehan target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></div><p class="text-bg font-bg" title=twitter></p></a></li><li class=mt-1><a href=https://github.com/kubehan target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></div><p class="text-bg font-bg" title=github></p></a></li></ul></div></label></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div id=hero class="h-[150px] md:h-[200px]"></div><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom" style=background-image:url(/posts/use-kubevirt-to-manage-windows-on-kubernetes/featured_hu7670721176766136980.jpg)><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("background-blur");n.style.opacity=t/300})</script><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>云原生知识栈</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/use-kubevirt-to-manage-windows-on-kubernetes/>Kubernetes 使用 Kubevirt 运行管理 Windows 10 操作系统</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Kubernetes 使用 Kubevirt 运行管理 Windows 10 操作系统</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2020-11-13T16:13:56+08:00>2020年11月13日</time><span class="px-2 text-primary-500">&#183;</span><span>1309 字</span><span class="px-2 text-primary-500">&#183;</span><span title=预计阅读>7 分钟</span><span class="px-2 text-primary-500">&#183;</span>
<span class=mb-[2px]><a href=https://github.com/kubehan/kubehanBooks/tree/main/content/posts/use-kubevirt-to-manage-windows-on-kubernetes/index.md class="text-lg hover:text-primary-500" rel="noopener noreferrer" target=_blank title=编辑内容><span class="inline-block align-text-bottom"><span class="relative block icon"><svg height="1em" viewBox="0 0 512 512"><path fill="currentcolor" d="M441 58.9 453.1 71c9.4 9.4 9.4 24.6.0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9.0zM209.8 256.2 344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1L186.9 325l16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25 175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 1e2c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l1e2-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7.0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4.0 152V424c0 48.6 39.4 88 88 88H360c48.6.0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1.0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H2e2c13.3.0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg></span></span></a></span></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt=Kubehan src=/img/blowfish_logo_hu10440971084165979012.png><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">作者</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Kubehan</div><div class="text-sm text-neutral-700 dark:text-neutral-400">云原生知识栈：深度解析容器技术、Kubernetes、Istio、DevOps 实践、Prometheus 监控、Envoy 代理、Golang 开发及云原生架构与微服务趋势的专业博客</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=/index.xml target=_blank aria-label=Rss rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M0 64C0 46.3 14.3 32 32 32c229.8.0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7.0 64zM128 416c0 35.3-28.7 64-64 64S0 451.3.0 416s28.7-64 64-64 64 28.7 64 64zM32 160c159.1.0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7.0-32-14.3-32-32s14.3-32 32-32z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://twitter.com/kubehan target=_blank aria-label=X-Twitter rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/kubehan target=_blank aria-label=Wechat rel="me noopener noreferrer"><span class="inline-block align-text-bottom"></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/kubehan target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:hello@kubehan.cn target=_blank aria-label=Email rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://kubehan.cn/ target=_blank aria-label=Link rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentcolor" d="M172.5 131.1c55.6-55.59 148-55.59 203.6.0 50 50 57.4 129.7 16.3 187.2L391.3 319.9C381 334.2 361 337.6 346.7 327.3c-14.4-10.3-17.8-30.3-7.5-44.6L340.3 281.1C363.2 249 359.6 205.1 331.7 177.2c-31.4-31.4-82.5-31.4-114 0L105.5 289.5c-31.51 30.6-31.51 82.5.0 114C133.3 431.4 177.3 435 209.3 412.1L210.9 410.1C225.3 400.7 245.3 404 255.5 418.4 265.8 432.8 262.5 452.8 248.1 463.1L246.5 464.2c-58.4 41.1-136.3 34.5-186.29-15.4-56.469-56.5-56.469-148.1.0-204.5L172.5 131.1zM467.5 380c-56.5 56.5-148 56.5-204.5.0-50-50-56.5-128.8-15.4-186.3L248.7 192.1C258.1 177.8 278.1 174.4 293.3 184.7 307.7 194.1 311.1 214.1 300.8 229.3L299.7 230.9C276.8 262.1 280.4 306.9 308.3 334.8c31.4 31.4 82.5 31.4 114 0L534.5 222.5c31.5-31.5 31.5-83.4.0-114C506.7 80.63 462.7 76.99 430.7 99.9L429.1 101C414.7 111.3 394.7 107.1 384.5 93.58 374.2 79.2 377.5 59.21 391.9 48.94L393.5 47.82C451 6.731 529.8 13.25 579.8 63.24c56.5 56.46 56.5 148.06.0 204.46L467.5 380z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><p>最近我发现我的 <code>Kubernetes</code> 集群资源实在是太多了，有点浪费，不信你看：</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201113174212.jpg alt></figure></p><p>既然闲置资源那么多，那我何不想办法利用一下。怎么用，用来干什么又是一个问题，想到我手中只有 MacBook，缺少 Windows 操作系统，那就先想办法用 Kubernetes 创建个 Windows 虚拟机用用吧，毕竟很多场景只能用 Windows（比如突破某盘的限速、Xshell 一把梭连接所有服务器）。于是我将目光转向了 Kubevirt。</p><p><code>Kubevirt</code> 是 Red Hat 开源的以容器方式运行虚拟机的项目，通过 <code>CRD</code> 的方式来管理虚拟机实例，它的所有概念都和一般的 Kubernetes 容器应用差不多，不需要增加学习成本，对于咱玩烂了容器的 YAML 工程师来说没有任何压力，我们可以直接用它来创建虚拟机啊。</p><h2 class="relative group">1. Kubevirt 架构设计<div id=1-kubevirt-%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-kubevirt-%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1 aria-label=锚点>#</a></span></h2><p>Kubevirt 主要实现了下面几种资源，以实现对虚拟机的管理：</p><ul><li><code>VirtualMachineInstance（VMI）</code> : 类似于 kubernetes Pod，是管理虚拟机的最小资源。一个 <code>VirtualMachineInstance</code> 对象即表示一台正在运行的虚拟机实例，包含一个虚拟机所需要的各种配置。</li><li><code>VirtualMachine（VM）</code> : 为群集内的 <code>VirtualMachineInstance</code> 提供管理功能，例如开机/关机/重启虚拟机，确保虚拟机实例的启动状态，与虚拟机实例是 1:1 的关系，类似与 <code>spec.replica</code> 为 1 的 StatefulSet。</li><li><code>VirtualMachineInstanceReplicaSet</code> : 类似 <code>ReplicaSet</code>，可以启动指定数量的 <code>VirtualMachineInstance</code>，并且保证指定数量的 <code>VirtualMachineInstance</code> 运行，可以配置 HPA。</li></ul><p>Kubevirt 的整体架构如图：</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201113233921.png alt></figure></p><ul><li><strong>virt-api</strong> : 负责提供一些 KubeVirt 特有的 api，像是 <code>console, vnc, startvm, stopvm</code> 等。</li><li><strong>virt-controller</strong> : 管理和监控 VMI 对象及其关联的 Pod，对其状态进行更新。</li><li><strong>virt-handler</strong> : 以 DaemonSet 运行在每一个节点上，监听 VMI 的状态向上汇报，管理 VMI 的生命周期。</li><li><strong>virt-launcher</strong> : 以 Pod 方式运行，每个 VMI Object 都会对应一个 virt-launcher Pod，容器内有单独的 <code>libvirtd</code>，用于启动和管理虚拟机。</li></ul><p>如果你嫌上面的架构图太繁琐，这里还有一个简化版：</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201113234247.png alt></figure></p><p>这个图里的 Agent 其实就是 virt-handler。</p><h2 class="relative group">2. 磁盘和卷<div id=2-%E7%A3%81%E7%9B%98%E5%92%8C%E5%8D%B7 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-%E7%A3%81%E7%9B%98%E5%92%8C%E5%8D%B7 aria-label=锚点>#</a></span></h2><p>虚拟机镜像（磁盘）是启动虚拟机必不可少的部分，KubeVirt 中提供多种方式的虚拟机磁盘，虚拟机镜像（磁盘）使用方式非常灵活。这里列出几种比较常用的：</p><ul><li><strong>PersistentVolumeClaim</strong> : 使用 PVC 做为后端存储，适用于数据持久化，即在虚拟机重启或者重建后数据依旧存在。使用的 PV 类型可以是 block 和 filesystem，使用 filesystem 时，会使用 PVC 上的 /disk.img，格式为 RAW 格式的文件作为硬盘。block 模式时，使用 block volume 直接作为原始块设备提供给虚拟机。</li><li><strong>ephemeral</strong> : 基于后端存储在本地做一个写时复制（COW）镜像层，所有的写入都在本地存储的镜像中，VM 实例停止时写入层就被删除，后端存储上的镜像不变化。</li><li><strong>containerDisk</strong> : 基于 scratch 构建的一个 docker image，镜像中包含虚拟机启动所需要的虚拟机镜像，可以将该 docker image push 到 registry，使用时从 registry 拉取镜像，直接使用 containerDisk 作为 VMI 磁盘，数据是无法持久化的。</li><li><strong>hostDisk</strong> : 使用节点上的磁盘镜像，类似于 <code>hostpath</code>，也可以在初始化时创建空的镜像。</li><li><strong>dataVolume</strong> : 提供在虚拟机启动流程中自动将虚拟机磁盘导入 pvc 的功能，在不使用 DataVolume 的情况下，用户必须先准备带有磁盘映像的 pvc，然后再将其分配给 VM 或 VMI。dataVolume 拉取镜像的来源可以时 http，对象存储，另一块 PVC 等。</li></ul><h2 class="relative group">3. 准备工作<div id=3-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C aria-label=锚点>#</a></span></h2><p>在安装 Kubevirt 之前，需要做一些准备工作。先安装 libvrt 和 qemu 软件包：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Ubuntu</span>
</span></span><span class=line><span class=cl>$ apt install -y qemu-kvm libvirt-bin bridge-utils virt-manager
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CentOS</span>
</span></span><span class=line><span class=cl>$ yum install -y qemu-kvm libvirt virt-install bridge-utils
</span></span></code></pre></div><p>查看节点是否支持 kvm 硬件辅助虚拟化</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ virt-host-validate qemu
</span></span><span class=line><span class=cl>  QEMU: Checking <span class=k>for</span> hardware virtualization                                 : PASS
</span></span><span class=line><span class=cl>  QEMU: Checking <span class=k>if</span> device /dev/kvm exists                                   : PASS
</span></span><span class=line><span class=cl>  QEMU: Checking <span class=k>if</span> device /dev/kvm is accessible                            : PASS
</span></span><span class=line><span class=cl>  QEMU: Checking <span class=k>if</span> device /dev/vhost-net exists                             : PASS
</span></span><span class=line><span class=cl>  QEMU: Checking <span class=k>if</span> device /dev/net/tun exists                               : PASS
</span></span><span class=line><span class=cl>  QEMU: Checking <span class=k>for</span> cgroup <span class=s1>&#39;memory&#39;</span> controller support                      : PASS
</span></span><span class=line><span class=cl>  QEMU: Checking <span class=k>for</span> cgroup <span class=s1>&#39;memory&#39;</span> controller mount-point                  : PASS
</span></span><span class=line><span class=cl>  QEMU: Checking <span class=k>for</span> cgroup <span class=s1>&#39;cpu&#39;</span> controller support                         : PASS
</span></span><span class=line><span class=cl>  QEMU: Checking <span class=k>for</span> cgroup <span class=s1>&#39;cpu&#39;</span> controller mount-point                     : PASS
</span></span><span class=line><span class=cl>  QEMU: Checking <span class=k>for</span> cgroup <span class=s1>&#39;cpuacct&#39;</span> controller support                     : PASS
</span></span><span class=line><span class=cl>  QEMU: Checking <span class=k>for</span> cgroup <span class=s1>&#39;cpuacct&#39;</span> controller mount-point                 : PASS
</span></span><span class=line><span class=cl>  QEMU: Checking <span class=k>for</span> cgroup <span class=s1>&#39;cpuset&#39;</span> controller support                      : PASS
</span></span><span class=line><span class=cl>  QEMU: Checking <span class=k>for</span> cgroup <span class=s1>&#39;cpuset&#39;</span> controller mount-point                  : PASS
</span></span><span class=line><span class=cl>  QEMU: Checking <span class=k>for</span> cgroup <span class=s1>&#39;devices&#39;</span> controller support                     : PASS
</span></span><span class=line><span class=cl>  QEMU: Checking <span class=k>for</span> cgroup <span class=s1>&#39;devices&#39;</span> controller mount-point                 : PASS
</span></span><span class=line><span class=cl>  QEMU: Checking <span class=k>for</span> cgroup <span class=s1>&#39;blkio&#39;</span> controller support                       : PASS
</span></span><span class=line><span class=cl>  QEMU: Checking <span class=k>for</span> cgroup <span class=s1>&#39;blkio&#39;</span> controller mount-point                   : PASS
</span></span><span class=line><span class=cl>  QEMU: Checking <span class=k>for</span> device assignment IOMMU support                         : PASS
</span></span><span class=line><span class=cl>  QEMU: Checking <span class=k>if</span> IOMMU is enabled by kernel                               : PASS
</span></span></code></pre></div><p>如果不支持，则先生成让 Kubevirt 使用软件虚拟化的配置：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl create namespace kubevirt
</span></span><span class=line><span class=cl>$ kubectl create configmap -n kubevirt kubevirt-config <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --from-literal debug.useEmulation<span class=o>=</span><span class=nb>true</span>
</span></span></code></pre></div><h2 class="relative group">4. 安装 Kubevirt<div id=4-%E5%AE%89%E8%A3%85-kubevirt class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4-%E5%AE%89%E8%A3%85-kubevirt aria-label=锚点>#</a></span></h2><h3 class="relative group">部署最新版本的 Kubevirt<div id=%E9%83%A8%E7%BD%B2%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84-kubevirt class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E9%83%A8%E7%BD%B2%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84-kubevirt aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>export</span> <span class=nv>VERSION</span><span class=o>=</span><span class=k>$(</span>curl -s https://api.github.com/repos/kubevirt/kubevirt/releases <span class=p>|</span> grep tag_name <span class=p>|</span> grep -v -- <span class=s1>&#39;-rc&#39;</span> <span class=p>|</span> head -1 <span class=p>|</span> awk -F<span class=s1>&#39;: &#39;</span> <span class=s1>&#39;{print $2}&#39;</span> <span class=p>|</span> sed <span class=s1>&#39;s/,//&#39;</span> <span class=p>|</span> xargs<span class=k>)</span>
</span></span><span class=line><span class=cl>$ kubectl apply -f https://github.com/kubevirt/kubevirt/releases/download/<span class=si>${</span><span class=nv>VERSION</span><span class=si>}</span>/kubevirt-operator.yaml
</span></span><span class=line><span class=cl>$ kubectl apply -f https://github.com/kubevirt/kubevirt/releases/download/<span class=si>${</span><span class=nv>VERSION</span><span class=si>}</span>/kubevirt-cr.yaml
</span></span></code></pre></div><p>查看部署结果：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl -n kubevirt get pod
</span></span><span class=line><span class=cl>NAME                               READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>virt-api-64999f7bf5-n9kcl          1/1     Running   <span class=m>0</span>          6d
</span></span><span class=line><span class=cl>virt-api-64999f7bf5-st5qv          1/1     Running   <span class=m>0</span>          6d8h
</span></span><span class=line><span class=cl>virt-controller-8696ccdf44-v5wnq   1/1     Running   <span class=m>0</span>          6d
</span></span><span class=line><span class=cl>virt-controller-8696ccdf44-vjvsw   1/1     Running   <span class=m>0</span>          6d8h
</span></span><span class=line><span class=cl>virt-handler-85rdn                 1/1     Running   <span class=m>3</span>          7d19h
</span></span><span class=line><span class=cl>virt-handler-bpgzp                 1/1     Running   <span class=m>21</span>         7d19h
</span></span><span class=line><span class=cl>virt-handler-d55c7                 1/1     Running   <span class=m>1</span>          7d19h
</span></span><span class=line><span class=cl>virt-operator-78fbcdfdf4-sf5dv     1/1     Running   <span class=m>0</span>          6d8h
</span></span><span class=line><span class=cl>virt-operator-78fbcdfdf4-zf9qr     1/1     Running   <span class=m>0</span>          6d
</span></span></code></pre></div><h3 class="relative group">部署 CDI<div id=%E9%83%A8%E7%BD%B2-cdi class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E9%83%A8%E7%BD%B2-cdi aria-label=锚点>#</a></span></h3><p><code>Containerized Data Importer</code>（CDI）项目提供了用于使 PVC 作为 KubeVirt VM 磁盘的功能。建议同时部署 CDI：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>export</span> <span class=nv>VERSION</span><span class=o>=</span><span class=k>$(</span>curl -s https://github.com/kubevirt/containerized-data-importer/releases/latest <span class=p>|</span> grep -o <span class=s2>&#34;v[0-9]\.[0-9]*\.[0-9]*&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>$ kubectl create -f https://github.com/kubevirt/containerized-data-importer/releases/download/<span class=nv>$VERSION</span>/cdi-operator.yaml
</span></span><span class=line><span class=cl>$ kubectl create -f https://github.com/kubevirt/containerized-data-importer/releases/download/<span class=nv>$VERSION</span>/cdi-cr.yaml
</span></span></code></pre></div><h2 class="relative group">5. 客户端准备<div id=5-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%87%86%E5%A4%87 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#5-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%87%86%E5%A4%87 aria-label=锚点>#</a></span></h2><p>Kubevirt 提供了一个命令行工具 <code>virtctl</code>，可以直接下载：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>export</span> <span class=nv>VERSION</span><span class=o>=</span><span class=k>$(</span>curl -s https://api.github.com/repos/kubevirt/kubevirt/releases <span class=p>|</span> grep tag_name <span class=p>|</span> grep -v -- <span class=s1>&#39;-rc&#39;</span> <span class=p>|</span> head -1 <span class=p>|</span> awk -F<span class=s1>&#39;: &#39;</span> <span class=s1>&#39;{print $2}&#39;</span> <span class=p>|</span> sed <span class=s1>&#39;s/,//&#39;</span> <span class=p>|</span> xargs<span class=k>)</span>
</span></span><span class=line><span class=cl>$ curl -L -o /usr/local/bin/virtctl https://github.com/kubevirt/kubevirt/releases/download/<span class=nv>$VERSION</span>/virtctl-<span class=nv>$VERSION</span>-linux-amd64
</span></span><span class=line><span class=cl>$ chmod +x /usr/local/bin/virtctl
</span></span></code></pre></div><p>也可以通过 <code>krew</code> 安装为 kubectl 的插件：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl krew install virt
</span></span></code></pre></div><h2 class="relative group">6. 虚拟机镜像准备<div id=6-%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%95%9C%E5%83%8F%E5%87%86%E5%A4%87 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#6-%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%95%9C%E5%83%8F%E5%87%86%E5%A4%87 aria-label=锚点>#</a></span></h2><h3 class="relative group">Windows 镜像下载<div id=windows-%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#windows-%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD aria-label=锚点>#</a></span></h3><p>这里推荐两个 Windows 镜像下载站：</p><p>① <a href=https://msdn.itellyou.cn/ target=_blank>MSDN I Tell You</a>。该网站提供的链接是 <code>ed2k</code> 格式，需要通过特殊下载工具进行下载，比如百度网盘离线下载、迅雷、eMule 等，其中百度网盘离线下载最好使，但下载限速又是个大问题，开了超级会员的当我没说。</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201122173815.png alt></figure></p><p>② <a href=https://tb.rg-adguard.net/public.php target=_blank>TechBench by WZT</a>。该网站提供的是直链下载方式，可以用任意下载工具进行下载，比上面的网站方便多了，不过资源没有上面的网站丰富。</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201122174051.jpg alt></figure></p><p>我推荐通过第二个网站来下载 Windows 镜像。</p><h3 class="relative group">上传镜像<div id=%E4%B8%8A%E4%BC%A0%E9%95%9C%E5%83%8F class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E4%B8%8A%E4%BC%A0%E9%95%9C%E5%83%8F aria-label=锚点>#</a></span></h3><p>KubeVirt 可以使用 PVC 作为后端磁盘，使用 <code>filesystem</code> 类型的 PVC 时，默认使用的时 <code>/disk.img</code> 这个镜像，用户可以将镜像上传到 PVC，在创建 VMI 时使用此 PVC。使用这种方式需要注意下面几点：</p><ul><li>一个 PVC 只允许存在一个镜像，只允许一个 VMI 使用，要创建多个 VMI，需要上传多次</li><li><code>/disk.img</code> 的格式必须是 RAW 格式</li></ul><p>CDI 提供了使用使用 PVC 作为虚拟机磁盘的方案，在虚拟机启动前通过下面方式填充 PVC：</p><ul><li>通过 URL 导入虚拟机镜像到 PVC，URL 可以是 http 链接，s3 链接</li><li>Clone 一个已经存在的 PVC</li><li>通过 container registry 导入虚拟机磁盘到 PVC，需要结合 <code>ContainerDisk</code> 使用</li><li>通过客户端上传本地镜像到 PVC</li></ul><p>通过命令行 <code>virtctl</code>，结合 CDI 项目，可以上传本地镜像到 PVC 上，支持的镜像格式有：</p><ul><li>.img</li><li>.qcow2</li><li>.iso</li><li>压缩为 .tar，.gz，.xz 格式的上述镜像</li></ul><p>我们的目标是安装 Windows 10 虚拟机，所以需要将上面下载好的 Windows 镜像上传到 PVC：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ virtctl image-upload <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --image-path<span class=o>=</span><span class=s1>&#39;Win10_20H2_Chinese(Simplified)_x64.iso&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --storage-class csi-rbd-sc <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --pvc-name<span class=o>=</span>iso-win10 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --pvc-size<span class=o>=</span>7G <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --uploadproxy-url<span class=o>=</span>https://&lt;cdi-uploadproxy_svc_ip&gt; <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --insecure <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --wait-secs<span class=o>=</span><span class=m>240</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PersistentVolumeClaim default/iso-win10 created
</span></span><span class=line><span class=cl>Waiting <span class=k>for</span> PVC iso-win10 upload pod to be ready...
</span></span><span class=line><span class=cl>Pod now ready
</span></span><span class=line><span class=cl>Uploading data to https://10.111.29.156
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 5.63 GiB / 5.63 GiB <span class=o>[======================================================================================================================================================]</span> 100.00% 27s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Uploading data completed successfully, waiting <span class=k>for</span> processing to complete, you can hit ctrl-c without interrupting the progress
</span></span><span class=line><span class=cl>Processing completed successfully
</span></span><span class=line><span class=cl>Uploading Win10_20H2_Chinese<span class=o>(</span>Simplified<span class=o>)</span>_x64.iso completed successfully
</span></span></code></pre></div><p>参数解释：</p><ul><li><strong>&ndash;image-path</strong> : 操作系统镜像地址。</li><li><strong>&ndash;pvc-name</strong> : 指定存储操作系统镜像的 PVC，这个 PVC 不需要提前准备好，镜像上传过程中会自动创建。</li><li><strong>&ndash;pvc-size</strong> : PVC 大小，根据操作系统镜像大小来设定，一般略大一个 G 就行。</li><li><strong>&ndash;uploadproxy-url</strong> : cdi-uploadproxy 的 Service IP，可以通过命令 <code>kubectl -n cdi get svc -l cdi.kubevirt.io=cdi-uploadproxy</code> 来查看。</li></ul><h2 class="relative group">7. 增加 hostDisk 支持<div id=7-%E5%A2%9E%E5%8A%A0-hostdisk-%E6%94%AF%E6%8C%81 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#7-%E5%A2%9E%E5%8A%A0-hostdisk-%E6%94%AF%E6%8C%81 aria-label=锚点>#</a></span></h2><p>Kubevirt 默认没有开启对 <code>hostDisk</code> 的支持，需要手动开启。步骤也很简单，只需新建个 ConfigMap，增加 <code>hostDisk</code> 的特性：</p><p><strong>kubevet-config.yaml</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>feature-gates</span><span class=p>:</span><span class=w> </span><span class=l>LiveMigration,DataVolumes,HostDisk</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kubevirt.io</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kubevirt-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>kubevirt</span><span class=w>
</span></span></span></code></pre></div><h2 class="relative group">7. 创建虚拟机<div id=7-%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#7-%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA aria-label=锚点>#</a></span></h2><p>创建 Windows 虚拟机的模板文件如下：</p><p><strong>win10.yaml</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>kubevirt.io/v1alpha3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>VirtualMachine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>win10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>running</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>kubevirt.io/domain</span><span class=p>:</span><span class=w> </span><span class=l>win10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>domain</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>cores</span><span class=p>:</span><span class=w> </span><span class=m>4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>devices</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>disks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>bootOrder</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cdrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>bus</span><span class=p>:</span><span class=w> </span><span class=l>sata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cdromiso</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>bus</span><span class=p>:</span><span class=w> </span><span class=l>virtio</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>harddrive</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>cdrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>bus</span><span class=p>:</span><span class=w> </span><span class=l>sata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>virtiocontainerdisk</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>interfaces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>masquerade</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>model</span><span class=p>:</span><span class=w> </span><span class=l>e1000 </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>machine</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>q35</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>16G</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pod</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cdromiso</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>persistentVolumeClaim</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>claimName</span><span class=p>:</span><span class=w> </span><span class=l>iso-win10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>harddrive</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>hostDisk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>capacity</span><span class=p>:</span><span class=w> </span><span class=l>50Gi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/data/disk.img</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>DiskOrCreate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>containerDisk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>kubevirt/virtio-container-disk</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>virtiocontainerdisk</span><span class=w>
</span></span></span></code></pre></div><p>这里用到了 3 个 Volume：</p><ul><li><strong>cdromiso</strong> : 提供操作系统安装镜像，即上文上传镜像后生成的 PVC <code>iso-win10</code>。</li><li><strong>harddrive</strong> : 虚拟机使用的磁盘，即操作系统就会安装在该磁盘上。这里选择 <code>hostDisk</code> 直接挂载到宿主机以提升性能，如果使用分布式存储则体验非常不好。</li><li><strong>containerDisk</strong> : 由于 Windows 默认无法识别 raw 格式的磁盘，所以需要安装 virtio 驱动。 containerDisk 可以将打包好 virtio 驱动的容器镜像挂载到虚拟机中。</li></ul><p>关于网络部分，<code>spec.template.spec.networks</code> 定义了一个网络叫 <code>default</code>，这里表示使用 Kubernetes 默认的 CNI。<code>spec.template.spec.domain.devices.interfaces</code> 选择定义的网络 default，并开启 <code>masquerade</code>，以使用网络地址转换 (NAT) 来通过 Linux 网桥将虚拟机连接至 Pod 网络后端。</p><p>使用模板文件创建虚拟机：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl apply -f win10.yaml
</span></span></code></pre></div><p>启动虚拟机实例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ virtctl start win10
</span></span><span class=line><span class=cl><span class=c1># 如果 virtctl 安装为 kubectl 的插件，命令格式如下：</span>
</span></span><span class=line><span class=cl>$ kubectl virt start win10
</span></span></code></pre></div><p>查看实例运行状态：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get pod
</span></span><span class=line><span class=cl>NAME                              READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>virt-launcher-win10-s742j         2/2     Running   <span class=m>0</span>          15s
</span></span></code></pre></div><p>然后就可以通过 VNC 工具来访问 Windows 虚拟机了。首先需要在本地安装一个 VNC 客户端，对于 macOS 来说，可以安装 Tiger VNC 或者 Real VNC。我选择安装 Real VNC：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ brew cask install vnc-viewer
</span></span></code></pre></div><p>连接到 Windows 虚拟机：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ virtctl vnc win10
</span></span><span class=line><span class=cl><span class=c1># 如果 virtctl 安装为 kubectl 的插件，命令格式如下：</span>
</span></span><span class=line><span class=cl>$ kubectl virt vnc win10
</span></span></code></pre></div><p>执行完上面的命令后，就会打开本地的 VNC 客户端连接到虚拟机：</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201122185926.png alt></figure></p><p>下面就是安装正常的安装步骤往下进行，到选择硬盘那一步的时候，你会发现没有一个硬盘可供使用，这时就需要安装 virtio 驱动了。</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201122190331.png alt></figure></p><p>不过不用担心，virtio 驱动已经被挂载进来了，直接点击<strong>加载驱动程序</strong>就可以安装驱动了：</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201122190505.png alt></figure></p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201122190628.png alt></figure></p><p>安装好驱动后，硬盘就能正确显示了：</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201122194231.png alt></figure></p><p>下面就可以继续安装了。</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201122194711.png alt></figure></p><p>安装成功后会自动重启进行初始化设置，那个熟悉的“海内存知己，天涯若比邻”又回来了：</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201122195000.png alt></figure></p><p>设置完成后，进入系统，打开设备管理器，可以看到有几个未配置的设备。选择其中一个右键单击，然后选择“更新驱动程序”。</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201122202548.png alt></figure></p><p>选择“浏览我的电脑以查找驱动程序”。</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201122202658.png alt></figure></p><p>选择“CD 驱动器（E:）virtio-win-0.1.1”，然后点击确定。</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201122202755.png alt></figure></p><p>设备管理器将自动找到正确的驱动程序，不需要指定驱动程序的路径。</p><p>在提示符下，单击“安装”。</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201122203249.png alt></figure></p><p>其他的设备驱动可以复制上面的步骤一一安装。</p><h2 class="relative group">8. CNI 插件问题解决<div id=8-cni-%E6%8F%92%E4%BB%B6%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#8-cni-%E6%8F%92%E4%BB%B6%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3 aria-label=锚点>#</a></span></h2><p>如果你的 Kubernetes 集群 CNI 插件用的是 Calico，这里会遇到虚拟机无法联网的问题。因为 Calico 默认禁用了容器的 ip forward 功能，而 <code>masquerade</code> 需要开启这个功能才能生效。</p><p>我们只需要修改 Calico 的 ConfigMap 就可以启用容器的 ip forward 功能了，执行以下命令打开 configmap <code>calico-config</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl -n kube-system edit cm calico-config
</span></span></code></pre></div><p>在 CNI 配置文件中加上以下的内容：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;container_settings&#34;</span><span class=err>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;allow_ip_forwarding&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=err>,</span>
</span></span></code></pre></div><p>修改完的配置文件内容：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl>  <span class=err>cni_network_config:</span> <span class=err>|-</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;k8s-pod-network&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;cniVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;0.3.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;plugins&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;calico&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;log_level&#34;</span><span class=p>:</span> <span class=s2>&#34;info&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;log_file_path&#34;</span><span class=p>:</span> <span class=s2>&#34;/var/log/calico/cni/cni.log&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;etcd_endpoints&#34;</span><span class=p>:</span> <span class=s2>&#34;__ETCD_ENDPOINTS__&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;etcd_key_file&#34;</span><span class=p>:</span> <span class=s2>&#34;__ETCD_KEY_FILE__&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;etcd_cert_file&#34;</span><span class=p>:</span> <span class=s2>&#34;__ETCD_CERT_FILE__&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;etcd_ca_cert_file&#34;</span><span class=p>:</span> <span class=s2>&#34;__ETCD_CA_CERT_FILE__&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;mtu&#34;</span><span class=p>:</span> <span class=err>__CNI_MTU__</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;ipam&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;calico-ipam&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;container_settings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;allow_ip_forwarding&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;policy&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;k8s&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;kubernetes&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;kubeconfig&#34;</span><span class=p>:</span> <span class=s2>&#34;__KUBECONFIG_FILEPATH__&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;portmap&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;snat&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;capabilities&#34;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&#34;portMappings&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;bandwidth&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;capabilities&#34;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&#34;bandwidth&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>然后重启 calico-node 容器：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl -n kube-system delete pod -l k8s-app<span class=o>=</span>calico-node
</span></span></code></pre></div><h2 class="relative group">8. 远程连接<div id=8-%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#8-%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5 aria-label=锚点>#</a></span></h2><p>在系统未安装好之前，只能用 VNC 来远程控制，但 VNC 的体验实在让人难受。现在系统装好了，就可以使用 Windows 的远程连接协议 RDP（Remote Desktop Protocol） 了。选择<strong>开始</strong> ><strong>设置</strong> ><strong>系统</strong>><strong>远程桌面</strong>，打开<strong>启用远程桌面</strong>就好了。</p><p>现在可以通过 telnet 来测试一下 RDP 端口（<code>3389</code>）的连通性：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get pod -owide
</span></span><span class=line><span class=cl>NAME                              READY   STATUS    RESTARTS   AGE     IP               NODE    NOMINATED NODE   READINESS GATES
</span></span><span class=line><span class=cl>virt-launcher-win10-s742j         2/2     Running   <span class=m>0</span>          139m    100.92.235.131   k8s03   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ telnet 100.92.235.131 <span class=m>3389</span>
</span></span><span class=line><span class=cl>Trying 100.92.235.131...
</span></span><span class=line><span class=cl>Connected to 100.92.235.131.
</span></span><span class=line><span class=cl>Escape character is <span class=s1>&#39;^]&#39;</span>.
</span></span></code></pre></div><p>如果你的本地电脑能够直连 <code>Pod IP</code> 和 <code>SVC IP</code>，现在就可以直接通过 RDP 客户端来远程连接 Windows 了。如果你的本地电脑不能直连 <code>Pod IP</code> 和 <code>SVC IP</code>，但可以直连 Kubernetes 集群的 <code>Node IP</code>，可以通过 <code>NodePort</code> 来暴露 RDP 端口。具体操作是创建一个 Service，类型为 NodePort：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl virt expose vm win10 --name win10-rdp --port <span class=m>3389</span> --target-port <span class=m>3389</span> --type NodePort
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ kubectl get svc
</span></span><span class=line><span class=cl>NAME                     TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>          AGE
</span></span><span class=line><span class=cl>kubernetes               ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP          17d
</span></span><span class=line><span class=cl>win10-rdp                NodePort    10.98.20.203    &lt;none&gt;        3389:31192/TCP   20m
</span></span></code></pre></div><p>然后就可以通过 <code>Node IP</code> 来远程连接 Windows 了。</p><p>如果你的本地操作系统是 <strong>Windows 10</strong>，可以在任务栏的搜索框中，键入“<strong>远程桌面连接</strong>”，然后选择“<strong>远程桌面连接</strong>”。在“远程桌面连接”中，键入你想要连接的电脑的名称（从步骤 1），然后选择“<strong>连接</strong>”。</p><p>如果你的本地操作系统是 <code>macOS</code>，需要在 App Store 中安装 <code>Microsoft Remote Desktop</code>。</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201122211440.png alt></figure></p><p>安装完之后打开应用，选择 <strong>Add PC</strong>：</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201122211718.png alt></figure></p><p>在 <strong>PC name</strong> 一栏中输入 <code>NodeIP+NodePort</code>，然后点击 <strong>Add</strong>。</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201122212017.png alt></figure></p><p>然后右击创建好的配置，选择 <strong>Connect</strong>：</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201122212258.png alt></figure></p><p>输入账号密码后就可以连接到 Windows 了。</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/20201122212610.jpg alt></figure></p><p>全屏之后就可以获得完美的远程桌面体验了，尽情玩耍吧！</p><h2 class="relative group">9. 参考<div id=9-%E5%8F%82%E8%80%83 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#9-%E5%8F%82%E8%80%83 aria-label=锚点>#</a></span></h2><ul><li><a href=http://blog.meoop.me/post/use-kubevirt-to-manage-virtualization-workloads-on-kubernetes/ target=_blank>在 Kubernetes 上使用 KubeVirt 管理虚拟机负载</a></li><li><a href=https://redhat-developer-demos.github.io/kubevirt-crc-windows-tutorial/ target=_blank>kubevirt-crc-windows-tutorial</a></li><li><a href=https://kubevirt.io/user-guide/ target=_blank>kubevirt user guide</a></li></ul></div></div><script>var oid="views_posts/use-kubevirt-to-manage-windows-on-kubernetes/index.md",oid_likes="likes_posts/use-kubevirt-to-manage-windows-on-kubernetes/index.md"</script><script type=text/javascript src=/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q+oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/3077.html><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Linux 内核调优简单教程</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2020-11-03T09:41:31+08:00>2020年11月03日</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/3115.html><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Kubernetes集群CPU使用率高达100%，详细排查过程！</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2020-12-09T03:54:17+08:00>2020年12月09日</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label=返回顶部 title=返回顶部>&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/tags/ title>标签</a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/categories/ title>分类</a></li></ul></nav><div class="flex items-center justify-between"></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script><head><meta charset=UTF-8></head><footer style="text-align:center;padding:20px 0;font-size:14px;color:#fff;background-color:transparent"><div style=margin-bottom:15px;font-size:18px>🌐 <strong style=font-size:16px>云原生知识栈 | www.kubehan.cn</strong></div><div style=margin-bottom:15px><span class=icp><a class=icp target=_blank href=https://beian.miit.gov.cn/ style=color:#4da8da;text-decoration:none;font-weight:700>黔ICP备20000869号-2
</a></span><span style=margin-left:10px>| 归属地：贵州省贵阳市</span></div><div style=margin-bottom:10px;font-size:14px><span>总访问量：</span>
<strong id=total-visits style=color:#4da8da>加载中...</strong>
<span style=margin-left:10px>| 今日访问量：</span>
<strong id=today-visits style=color:#4da8da>加载中...</strong></div><div style=margin-top:15px;font-size:12px;opacity:.8><a href=https://kubehan.cn/categories/ target=_blank style=color:#4da8da;text-decoration:none;margin-right:15px>关于本站
</a><a href=https://kubehan.cn/%E5%85%B3%E4%BA%8E%E6%88%91/wechat_qr_code.png target=_blank style=color:#4da8da;text-decoration:none;margin-right:15px>联系我们
</a><a href=https://kubehan.cn/index.xml target=_blank style=color:#4da8da;text-decoration:none>订阅</a></div><script>document.addEventListener("DOMContentLoaded",function(){let s=100230,e=localStorage.getItem("totalVisits"),t=localStorage.getItem("todayVisits");e||(e=s),t||(t=0);let n=Math.floor(Math.random()*8)+1;t=parseInt(t)+n,e=parseInt(e)+n,e<t&&(e=t+e),localStorage.setItem("totalVisits",e),localStorage.setItem("todayVisits",t),document.getElementById("total-visits").textContent=e,document.getElementById("today-visits").textContent=t})</script></footer></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://kubehan.cn/ style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=搜索 tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="关闭 (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>